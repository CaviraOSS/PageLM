import { useState, useEffect } from 'react'
import { Link, useLocation } from 'react-router-dom'
import { getChats } from "../lib/api";

interface Chat {
  id: string;
  title?: string;
}

interface ChatsResponse {
  chats: Chat[];
}

export default function Sidebar() {
  const p = useLocation().pathname
  const [isToggled, setIsToggled] = useState(false)
  const [chats, setChats] = useState<ChatsResponse | null>(null);

  useEffect(() => {
    getChats().then(data => setChats(data));
  }, []);

  const b = (t: string) => `p-2 rounded-xl duration-300 transition-all ${p === t ? 'text-white bg-stone-800' : 'hover:bg-stone-900 hover:text-stone-200'}`
  const chatButtonClass = `p-2 rounded-xl duration-300 transition-all ${isToggled ? 'text-white bg-stone-800' : 'hover:bg-stone-900 hover:text-stone-200'}`
  function toggleC() {
    const idk = document.getElementById("idk")
    idk?.classList.toggle("flex");
    idk?.classList.toggle("hidden");
    document.getElementById("idk0")?.classList.toggle("md:rounded-r-none")
    setIsToggled(!isToggled)
  }

  return (
    <aside className='left-0 bottom-0 w-screen md:w-fit md:h-screen fixed p-4 z-50 lg:flex'>
      <div id='idk' className='w-64 md:order-2 h-full z-40 rounded-l-none rounded-2xl bg-stone-950 border border-l-transparent border-stone-900 hidden flex-col p-4 space-y-3 overflow-y-auto custom-scroll'>
        {chats?.chats.map((chat) => (
          <Link key={chat.id} to={`/chat/?chatId=${chat.id}`} className='p-2 hover:text-stone-200 hover:bg-stone-900 w-full rounded-xl block text-sm min-h-fit truncate'>
            {chat.title || 'Untitled Chat'}
          </Link>
        ))}
      </div>
      <div id='idk0' className='md:w-20 md:order-1 h-full rounded-3xl bg-stone-950/50 backdrop-blur-xl border border-stone-900 text-stone-400 flex flex-col items-center justify-between py-4'>
        <img src='/logo.png' alt='logo' className='w-10 h-auto rounded-full hidden md:block' />
        <nav className='flex md:flex-col items-center space-x-4 md:space-x-0 md:space-y-2 my-auto'>
          <Link to='/' className={b('/')}>
            <svg className="size-6" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6.29367 4.96556C3.62685 6.90311 2.29344 7.87189 1.76974 9.30291C1.72773 9.41771 1.68994 9.534 1.65645 9.65157C1.23901 11.1171 1.74832 12.6846 2.76696 15.8197C3.78559 18.9547 4.2949 20.5222 5.49405 21.4625C5.59025 21.5379 5.68918 21.6098 5.79064 21.678C7.05546 22.5279 8.70364 22.5279 12 22.5279C15.2964 22.5279 16.9446 22.5279 18.2094 21.678C18.3108 21.6098 18.4098 21.5379 18.506 21.4625C19.7051 20.5222 20.2144 18.9547 21.2331 15.8197C22.2517 12.6846 22.761 11.1171 22.3436 9.65157C22.3101 9.534 22.2723 9.41771 22.2303 9.30291C21.7066 7.87189 20.3732 6.90312 17.7064 4.96557C15.0395 3.02801 13.7061 2.05923 12.1833 2.00336C12.0611 1.99888 11.9389 1.99888 11.8167 2.00336C10.2939 2.05923 8.96048 3.02801 6.29367 4.96556ZM10 17.0697C9.58579 17.0697 9.25 17.4054 9.25 17.8197C9.25 18.2339 9.58579 18.5697 10 18.5697H14C14.4142 18.5697 14.75 18.2339 14.75 17.8197C14.75 17.4054 14.4142 17.0697 14 17.0697H10Z" fill="currentColor" /></svg>
          </Link>
          <button onClick={() => toggleC()} className={chatButtonClass}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M12 1.25C6.06294 1.25 1.25 6.06294 1.25 12C1.25 17.9371 6.06294 22.75 12 22.75C17.9371 22.75 22.75 17.9371 22.75 12C22.75 6.06294 17.9371 1.25 12 1.25ZM12.75 8C12.75 7.58579 12.4142 7.25 12 7.25C11.5858 7.25 11.25 7.58579 11.25 8L11.25 11.5C11.25 12.7426 12.2574 13.75 13.5 13.75H15C15.4142 13.75 15.75 13.4142 15.75 13C15.75 12.5858 15.4142 12.25 15 12.25H13.5C13.0858 12.25 12.75 11.9142 12.75 11.5L12.75 8Z" fill="currentColor" /></svg>
          </button>
          <Link to='/tools' className={b('/tools')}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M4.99999 11.0781V13.6264C4.99999 15.4877 4.99999 16.4184 5.24471 17.1715C5.7393 18.6937 6.93272 19.8871 8.45491 20.3817C9.20807 20.6264 10.1387 20.6264 12 20.6264C13.8613 20.6264 14.7919 20.6264 15.5451 20.3817C17.0673 19.8871 18.2607 18.6937 18.7553 17.1715C19 16.4184 19 15.4877 19 13.6264V11.0813M19 11.0813C18.0427 11.4693 16.8601 11.8907 15.4529 12.3933L13.3455 13.146C12.6795 13.3838 12.3465 13.5028 12.0001 13.5028C11.6537 13.5028 11.3207 13.3838 10.6547 13.146L8.54734 12.3933C4.14668 10.8217 1.94635 10.0358 1.94635 8.62638C1.94635 7.21695 4.14668 6.4311 8.54734 4.85942L10.6547 4.10677C11.3207 3.86892 11.6537 3.75 12.0001 3.75C12.3465 3.75 12.6795 3.86892 13.3455 4.10677L15.4529 4.85942C19.8535 6.4311 22.0539 7.21695 22.0539 8.62638C22.0539 9.58509 21.0361 10.2561 19 11.0813Z" stroke="currentColor" stroke-width="1.5" />
              <path d="M10.5005 3.36538L8.23248 4.17545C6.08494 4.94242 4.39712 5.54521 3.25195 6.13759C2.14511 6.71014 1.19629 7.44609 1.19629 8.62638V15.6381C1.19629 16.0523 1.58572 16.3764 1.99993 16.3764C2.41415 16.3764 2.74993 16.0406 2.74993 15.6264V10.8351C2.46167 10.6602 2.19506 10.4693 1.96701 10.2565C1.50122 9.82179 1.19629 9.29549 1.19629 8.62638C1.19629 8.21216 1.58572 7.87638 1.99993 7.87638C2.07344 7.87638 2.14279 7.88695 2.20714 7.90666L2 7.99988L2.15664 8.62643H2.69635C2.69635 8.85558 2.84769 9.21727 3.94119 9.78292C4.98525 10.323 6.57627 10.893 8.7996 11.6871L10.907 12.4397C11.622 12.6951 11.8136 12.7528 12.0001 12.7528C12.1866 12.7528 12.3782 12.6951 13.0932 12.4397L15.271 11.6619C16.6524 11.1686 17.7947 10.7606 18.7183 10.3863C19.7289 9.97669 20.4109 9.63369 20.8337 9.30907C21.2397 8.99736 21.3039 8.78585 21.3039 8.62643H22.8038C22.8038 8.62642 22.8038 8.62645 22.8038 8.62643C22.8038 7.44614 21.855 6.71014 20.7481 6.13759C19.603 5.54521 17.9151 4.94242 15.7676 4.17544L13.4996 3.36539C12.9298 3.16135 12.4793 3 12 3C11.5208 3 11.0703 3.16135 10.5005 3.36538Z" fill="currentColor" />
              <path d="M22.8006 8.74459C22.7698 9.29407 22.5251 9.74782 22.1636 10.1277C22.5292 9.74561 22.7703 9.29483 22.8006 8.74459Z" fill="currentColor" />
            </svg>
          </Link>
          <Link to='/planner' className={b('/planner')}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path fillRule="evenodd" d="M7.5 5.25a3 3 0 0 1 3-3h3a3 3 0 0 1 3 3v.205c.933.085 1.857.197 2.774.334 1.454.218 2.476 1.483 2.476 2.917v3.033c0 1.211-.734 2.352-1.936 2.752A24.726 24.726 0 0 1 12 15.75c-2.73 0-5.357-.442-7.814-1.259-1.202-.4-1.936-1.541-1.936-2.752V8.706c0-1.434 1.022-2.7 2.476-2.917A48.814 48.814 0 0 1 7.5 5.455V5.25Zm7.5 0v.09a49.488 49.488 0 0 0-6 0v-.09a1.5 1.5 0 0 1 1.5-1.5h3a1.5 1.5 0 0 1 1.5 1.5Zm-3 8.25a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5Z" clipRule="evenodd" fill="currentColor" />
              <path d="M3 18.4v-2.796a4.3 4.3 0 0 0 .713.31A26.226 26.226 0 0 0 12 17.25c2.892 0 5.68-.468 8.287-1.335.252-.084.49-.189.713-.311V18.4c0 1.452-1.047 2.728-2.523 2.923-2.12.282-4.282.427-6.477.427a49.19 49.19 0 0 1-6.477-.427C4.047 21.128 3 19.852 3 18.4Z" fill="currentColor" />
            </svg>
          </Link>
          <Link to='/debate' className={b('/debate')}>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" className="size-6">
              <path fillRule="evenodd" d="M4.848 2.771A49.144 49.144 0 0 1 12 2.25c2.43 0 4.817.178 7.152.52 1.978.292 3.348 2.024 3.348 3.97v6.02c0 1.946-1.37 3.678-3.348 3.97a48.901 48.901 0 0 1-3.476.383.39.39 0 0 0-.297.17l-2.755 4.133a.75.75 0 0 1-1.248 0l-2.755-4.133a.39.39 0 0 0-.297-.17 48.9 48.9 0 0 1-3.476-.384c-1.978-.29-3.348-2.024-3.348-3.97V6.741c0-1.946 1.37-3.68 3.348-3.97ZM6.75 8.25a.75.75 0 0 1 .75-.75h9a.75.75 0 0 1 0 1.5h-9a.75.75 0 0 1-.75-.75Zm.75 2.25a.75.75 0 0 0 0 1.5H12a.75.75 0 0 0 0-1.5H7.5Z" clipRule="evenodd" />
            </svg>
          </Link>
          <Link to='/quiz' className={b('/quiz')}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.5945 5.20819C12.4024 4.59727 11.5976 4.59727 11.4055 5.20819C11.1268 6.09399 10.3176 6.71631 9.38004 6.71631C9.08998 6.71631 8.87351 6.89471 8.7855 7.17451C8.69695 7.45601 8.76928 7.75176 9.02062 7.9404C9.76396 8.49829 10.0637 9.47391 9.78623 10.3561C9.68379 10.6818 9.80639 10.9606 10.0214 11.122C10.2328 11.2807 10.4976 11.304 10.7402 11.122C11.4897 10.5594 12.5103 10.5594 13.2598 11.122C13.5024 11.304 13.7672 11.2807 13.9786 11.122C14.1936 10.9606 14.3162 10.6818 14.2138 10.3561C13.9363 9.47391 14.236 8.49829 14.9794 7.9404C15.2307 7.75176 15.303 7.45601 15.2145 7.17451C15.1265 6.89471 14.91 6.71631 14.62 6.71631C13.6824 6.71631 12.8732 6.09399 12.5945 5.20819Z" fill="currentColor" />
              <path fill-rule="evenodd" clip-rule="evenodd" d="M3.24999 9C3.24999 4.16751 7.1675 0.25 12 0.25C16.8325 0.25 20.75 4.16751 20.75 9C20.75 9.42706 20.7193 9.84715 20.6601 10.2581C20.5335 10.5946 20.3877 10.9218 20.2243 11.2382C18.9126 13.7781 16.4595 15.6312 13.5471 16.1213C13.0445 16.2059 12.5277 16.25 12 16.25C11.383 16.25 10.7808 16.1897 10.1988 16.0749C7.34647 15.5122 4.96255 13.6362 3.70639 11.1011C3.57078 10.8274 3.44832 10.5461 3.33982 10.2578C3.28062 9.84693 3.24999 9.42694 3.24999 9ZM9.97458 4.75812C10.6071 2.74729 13.3929 2.74729 14.0254 4.75812C14.1156 5.0448 14.3641 5.21631 14.62 5.21631C16.729 5.21631 17.4921 7.93003 15.8798 9.1401C15.6576 9.30685 15.5533 9.61567 15.6447 9.90599C15.9545 10.8912 15.5571 11.8128 14.879 12.3217C14.1975 12.8332 13.1963 12.9498 12.3594 12.3217C12.1434 12.1595 11.8566 12.1595 11.6406 12.3217C10.8037 12.9498 9.80252 12.8332 9.12096 12.3217C8.44292 11.8128 8.04546 10.8912 8.35535 9.90599C8.44667 9.61567 8.3424 9.30685 8.12023 9.1401C6.5079 7.93003 7.27098 5.21631 9.38004 5.21631C9.63594 5.21631 9.8844 5.0448 9.97458 4.75812Z" fill="currentColor" />
              <path d="M3.26361 13.2652C3.17496 13.4153 3.08158 13.5771 2.98101 13.7513L1.15503 16.914C0.929565 17.3044 0.721084 17.6654 0.600886 17.9642C0.483153 18.2569 0.33488 18.7645 0.662541 19.2343C0.994353 19.71 1.52698 19.7382 1.84263 19.7225C2.16223 19.7066 2.56851 19.6267 3.00494 19.5407L3.79621 19.3851C4.23487 19.2988 4.49513 19.2491 4.68823 19.2358C4.77643 19.2297 4.82378 19.2338 4.84708 19.2377C4.85779 19.2395 4.8641 19.2416 4.8641 19.2416L4.86704 19.243L4.86969 19.2449C4.86969 19.2449 4.87469 19.2493 4.8816 19.2576C4.89664 19.2759 4.92385 19.3148 4.9627 19.3942C5.04775 19.5681 5.13478 19.8184 5.27939 20.2414L5.54021 21.0044C5.68403 21.4254 5.81792 21.8172 5.96396 22.102C6.1082 22.3832 6.39894 22.8304 6.97685 22.8798C7.54752 22.9287 7.91294 22.5465 8.10756 22.2982C8.30625 22.0447 8.51464 21.6836 8.74 21.2932L10.5293 18.1941C10.6358 18.0096 10.7331 17.8409 10.8209 17.686C10.5128 17.6524 10.2084 17.6057 9.90843 17.5465C7.18111 17.0085 4.82605 15.4403 3.26361 13.2652Z" fill="currentColor" />
              <path d="M20.5814 13.4757C20.6268 13.554 20.6735 13.635 20.7219 13.7188L22.5667 16.9141C22.7921 17.3044 23.0006 17.6654 23.1208 17.9642C23.2385 18.2569 23.3868 18.7645 23.0591 19.2343C22.7273 19.71 22.1947 19.7382 21.879 19.7225C21.5594 19.7066 21.1532 19.6267 20.7167 19.5407L19.9255 19.3851C19.4868 19.2988 19.2265 19.2491 19.0334 19.2358C18.9452 19.2297 18.8979 19.2338 18.8746 19.2377C18.8639 19.2395 18.8576 19.2416 18.8576 19.2416L18.8546 19.243L18.8532 19.2439L18.852 19.2449C18.852 19.2449 18.847 19.2493 18.8401 19.2576C18.825 19.2759 18.7978 19.3148 18.759 19.3942C18.6739 19.5681 18.5869 19.8184 18.4423 20.2414L18.1815 21.0044C18.0376 21.4254 17.9037 21.8173 17.7577 22.102C17.6135 22.3832 17.3227 22.8304 16.7448 22.8798C16.1741 22.9287 15.8087 22.5465 15.6141 22.2982C15.4154 22.0447 15.207 21.6837 14.9817 21.2932L13.1923 18.194C13.0917 18.0196 12.9992 17.8594 12.9152 17.7115C13.2123 17.6865 13.5061 17.6493 13.7961 17.6005C16.559 17.1356 18.9623 15.618 20.5814 13.4757Z" fill="currentColor" />
            </svg>
          </Link>
          <Link to='/cards' className={b('/cards')}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.24472 6.45492C5 7.20808 5 8.13872 5 10V17.3874C5 19.3045 5 20.2631 5.34196 20.77C5.75971 21.3893 6.48778 21.7242 7.22986 21.6383C7.8373 21.568 8.56509 20.9442 10.0207 19.6966C10.6614 19.1474 10.9818 18.8728 11.3337 18.7484C11.7648 18.5961 12.2352 18.5961 12.6663 18.7484C13.0182 18.8728 13.3386 19.1474 13.9793 19.6965C15.4349 20.9442 16.1627 21.568 16.7701 21.6383C17.5122 21.7242 18.2403 21.3893 18.658 20.77C19 20.2631 19 19.3045 19 17.3874V10C19 8.13872 19 7.20808 18.7553 6.45492C18.2607 4.93273 17.0673 3.73931 15.5451 3.24472C14.7919 3 13.8613 3 12 3C10.1387 3 9.20808 3 8.45492 3.24472C6.93273 3.73931 5.73931 4.93273 5.24472 6.45492ZM12 5.25C11.5858 5.25 11.25 5.58579 11.25 6C11.25 6.41421 11.5858 6.75 12 6.75C13.7949 6.75 15.25 8.20507 15.25 10C15.25 10.4142 15.5858 10.75 16 10.75C16.4142 10.75 16.75 10.4142 16.75 10C16.75 7.37665 14.6234 5.25 12 5.25Z" fill="currentColor" /></svg>
          </Link>
        </nav>
      </div>
    </aside>
  )
}
